(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{518:function(t,e,n){var content=n(530);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(22).default)("28797276",content,!0,{sourceMap:!1})},519:function(t,e,n){var content=n(532);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(22).default)("701c9bfb",content,!0,{sourceMap:!1})},520:function(t,e,n){"use strict";var r=n(543),o=n.n(r),c=n(546),l=n.n(c),d=n(548),f=n.n(d),v=(n(24),n(36),n(37),n(16)),m=(n(10),n(28),n(153),n(550),n(33),n(39),n(23),n(355),n(40),n(41),{name:"Chart",emits:["select","loaded"],props:{type:String,data:null,options:null,plugins:null,height:{type:Number,default:200}},chart:null,mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},watch:{data:{handler:function(){console.log(this.data),this.refresh()},deep:!0},type:function(){this.refresh()},options:function(){this.refresh()}},methods:{initChart:function(){var t=this;n.e(15).then(n.bind(null,589)).then((function(e){t.chart&&(t.chart.destroy(),t.chart=null),e&&e.default&&(t.chart=new e.default(t.$refs.canvas,{type:t.type,data:t.data,options:t.options,plugins:t.plugins})),t.$emit("loaded",t.chart)}))},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&(this.chart.data=this.data,console.log("Updating chart"),this.chart.update())},reinit:function(){this.initChart()},onCanvasClick:function(t){if(this.chart){var element=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!1),e=null;e=element&&element[0]?this.chart.data.datasets[element[0].datasetIndex]:this.chart.getElementsAtEventForMode(t,"dataset",{intersect:!0},!1),element&&element[0]&&e&&this.$emit("select",{originalEvent:t,element:element[0],dataset:e})}}}}),h=m,y=(n(529),n(15)),_=Object(y.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-chart w-full"},[n("canvas",{ref:"canvas",attrs:{height:t.height},on:{click:function(e){return t.onCanvasClick(e)}}})])}),[],!1,null,null,null).exports,C=n(522),D=n(503),w=n(0),k=n.n(w),O=n(38),x=n(534),j=n(533),M=n(521),F=(n(34),n(32),n(59),{name:"DeviceInfo",components:{Badge:D.a},props:{device:{required:!0}},data:function(){return{}},computed:{name:function(){return this.device.device?this.device.device.name:this.device.name}},mounted:function(){this.device.device&&this.$router.push("/devices/"+this.device.device.id)},methods:{blockDevice:function(t){var e=this;this.$store.dispatch("devices/blockDevice",t.id).finally((function(){e.$router.replace("/devices")}))}}}),$=Object(y.a)(F,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.device?n("div",[n("header",[n("div",{staticClass:"py-4"},[n("h1",{staticClass:"text-3xl font-bold leading-tight text-gray-900"},[t._v(t._s(t.name?t.name:"Unknown"))])])]),t._v(" "),n("div",{staticClass:"space-y-8 divide-y divide-gray-200 mt-4"},[n("div",{staticClass:"space-y-8 divide-y divide-gray-200 sm:space-y-5"},[n("div",[n("div",{staticClass:"space-x-4"},[t.device.device?n("badge",{staticClass:"cursor-pointer text-lg leading-6 font-medium text-gray-900",attrs:{icon:"eye"},nativeOn:{click:function(e){return t.$router.push("/devices/"+t.device.device.id)}}},[t._v("Show device")]):t._e(),t._v(" "),n("badge",{staticClass:"cursor-pointer text-lg leading-6 font-medium",attrs:{icon:"ban",color:"red"},nativeOn:{click:function(e){return t.blockDevice(t.device)}}},[t._v("Block device")])],1),t._v(" "),n("div",{staticClass:"mt-6 sm:mt-5 space-y-6 sm:space-y-5"},[n("div",{staticClass:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},[n("label",{staticClass:"block text-sm font-medium text-gray-700"},[t._v(" First seen ")]),t._v(" "),n("div",{staticClass:"mt-1 sm:mt-0 sm:col-span-2"},[n("span",[t._v(t._s(t._f("formatDate")(t.device.firstSeen,"LLL")))])])]),t._v(" "),n("div",{staticClass:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},[n("label",{staticClass:"block text-sm font-medium text-gray-700"},[t._v(" Last active ")]),t._v(" "),n("div",{staticClass:"mt-1 sm:mt-0 sm:col-span-2"},[n("span",[t._v(t._s(t._f("formatDate")(t.device.lastQuery,"fromNow"))+" ago")])])]),t._v(" "),t.device.device?n("div",{staticClass:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},[n("label",{staticClass:"block text-sm font-medium text-gray-700"},[t._v(" Device Type ")]),t._v(" "),n("div",{staticClass:"mt-1 sm:mt-0 sm:col-span-2"},[n("span",[t._v(t._s(t.device.device.device_type.name))])])]):t._e()])])])])]):t._e()}),[],!1,null,"37d25084",null).exports,P=(n(74),n(537));function I(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function Y(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?I(Object(source),!0).forEach((function(e){Object(v.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):I(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var E={name:"CompanyDetail",components:{DataCard:n(505).a,LocationMap:P.a,Badge:D.a},props:{company:{required:!0}},data:function(){return{}},computed:{locations:function(){var t=[],e=[];return this.company.servers.forEach((function(n){if(n.location&&!e.includes(n.location.id)){e.push(n.location.id);var r=Y(Y({},n.location),{},{servers:[n]});t.push(r)}else n.location&&t[e.indexOf(n.location.id)].servers.push(n)})),t}}},S=Object(y.a)(E,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.company?n("div",[n("header",[n("div",{staticClass:"py-4"},[n("h1",{staticClass:"text-3xl font-bold leading-tight text-gray-900"},[t._v(t._s(t.company.name))])])]),t._v(" "),n("div",{staticClass:"space-y-8 divide-y divide-gray-200 mt-4"},[n("div",{staticClass:"space-y-8 divide-y divide-gray-200 sm:space-y-5"},[n("div",[n("div",{staticClass:"mt-6 sm:mt-5 space-y-6 sm:space-y-5"},[t.company.servers.length?n("div",{staticClass:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},[n("label",{staticClass:"block text-sm font-medium text-gray-700"},[t._v(" Locations ")]),t._v(" "),n("div",{staticClass:"mt-1 sm:mt-0 sm:col-span-2"},[n("location-map",{attrs:{locations:t.locations}})],1)]):t._e(),t._v(" "),t.company.servers.length?n("div",{staticClass:"sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5"},[n("label",{staticClass:"block text-sm font-medium text-gray-700"},[t._v(" Servers ")]),t._v(" "),n("div",{staticClass:"mt-1 sm:mt-0 sm:col-span-2"},[n("table",[t._m(0),t._v(" "),t._l(t.company.servers,(function(e){return n("tr",{key:e.id},[n("td",t._l(e.domains,(function(e){return n("div",{key:e.id},[t._v(t._s(e.name))])})),0),t._v(" "),e.location?n("td",[t._v("\n                                        "+t._s(e.location.city)+" "+t._s(e.location.country)+"\n                                    ")]):n("td",[t._v("\n                                        -\n                                    ")]),t._v(" "),n("td",[t._v("\n                                        "+t._s(t.$filters.formatSize(e.traffic))+"\n                                    ")])])}))],2)])]):t._e()])])])])]):t._e()}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("th",[t._v("Domains")]),t._v(" "),n("th",[t._v("Location")]),t._v(" "),n("th",[t._v("Traffic")])])}],!1,null,"48cb10a1",null).exports,T=n(152);function L(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function B(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?L(Object(source),!0).forEach((function(e){Object(v.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):L(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var U={name:"TrafficChart",components:{CompanyDetail:S,DeviceInfo:$,ServerGroupDetail:M.a,ServerGroupCard:j.a,Modal:x.a,Chart:_,Card:C.a,Badge:D.a},props:{filter:{default:function(){return{group_by:"src"}}}},data:function(){var t=this;return{loading:!1,groupInfo:null,options:{calendarView:{day:"date",week:"date",month:"month",year:"year"},duration:[{name:"Day",key:"day"},{name:"Week",key:"week"},{name:"Month",key:"month"},{name:"Year",key:"year"}]},showCalendar:!1,selectedDate:null,timeFilter:{duration:"week",date:null},colors:{},lineStylesData:{labels:[],datasets:[]},chartPlugins:[{afterUpdate:function(e){var n=e.data.datasets;t.$refs.legend.innerHTML="",n.forEach((function(n,i){var meta=e.getDatasetMeta(i),r=n.borderColor,text=[];text.push('<div class="text-sm cursor-pointer">'),text.push('<span class="legend-block" style="background-color:'+r+'; color: #ffffff;"><i class="la la-eye"></i></span>'),text.push('<span style="'+(meta.hidden?"text-decoration: line-through;":"")+'">'+n.label+"</span>"),text.push("</div>");var div=document.createElement("div");div.innerHTML=text.join("");var o=div.firstChild;o.firstChild.onclick=function(){t.groupInfo=n.labelData},o.onclick=function(){meta.hidden=!meta.hidden,e.update()},t.$refs.legend.appendChild(o)}))}}],basicOptions:{spanGaps:!0,plugins:{legend:{display:!1,position:"right",onClick:function(e,n,legend){console.log(n),t.groupInfo=Object.values(t.mappedTraffic.labels)[n.datasetIndex]}},tooltip:{callbacks:{label:function(e){var label=e.dataset.label||"";return label&&(label+=": "),null!==e.parsed.y&&(label+=t.$filters.formatSize(e.parsed.y)),label}}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{callback:function(e,n,r){return t.$filters.formatSize(e)},color:"#495057"},grid:{color:"#ebedef"}}}}}},mounted:function(){this.selectDate(new Date)},watch:{"timeFilter.duration":function(){this.selectDate(this.selectedDate)},timeFilter:{handler:function(){this.getTrafficData()},deep:!0},filter:{handler:Object(T.debounce)((function(){this.getTrafficData()}),100),deep:!0}},computed:B(B({},Object(O.d)({mappedTraffic:function(t){return t.traffic.mappedTraffic},servers:function(t){return t.traffic.servers},devices:function(t){return t.traffic.devices}})),{},{showModal:{set:function(){this.groupInfo=null},get:function(){return this.groupInfo}},formattedDate:function(){if(!this.timeFilter.date)return null;var t=this.timeFilter.date[0];switch(this.timeFilter.duration){case"day":return k()(t).format("DD/MM/YYYY");case"week":return"Week "+k()(t).week();case"month":return k()(t).format("MMMM");case"year":return k()(t).format("YYYY")}},graphData:function(){var t=this;if(null==this.mappedTraffic)return null;var e={},n=this.mappedTraffic.labels,data=this.mappedTraffic.data,r=Object.keys(this.mappedTraffic.data);for(var o in data)if(data.hasOwnProperty(o))for(var label in data[o])data[o].hasOwnProperty(label)&&(e.hasOwnProperty(label)||(e[label]={}),e[label][o]=data[o][label]);var c=this.$parsers.generateColors({quantity:Object.keys(e).length});console.log(c),e=Object.keys(e).map((function(label,o){var l,d=r.map((function(t){return e[label].hasOwnProperty(t)?e[label][t]:null}));return t.colors[label]=c[o],t.colors.hasOwnProperty(label),{label:null!==(l=t.$parsers.getLabelName(n[label]))&&void 0!==l?l:"Unknown",labelData:n[label],data:d,borderColor:t.colors[label],tension:.5}}));var l=r.map((function(t){return k()(t).format("DD/MM/YYYY HH:mm")}));return{labels:l,datasets:e}}}),methods:{getTrafficData:function(){var t=this;this.loading=!0,this.$store.dispatch("traffic/getTrafficData",B(B({},this.timeFilter),this.filter)).finally((function(){t.loading=!1}))},selectDate:function(t){var e;if(e=Array.isArray(t)?t[0]:t,"week"===this.timeFilter.duration){var n=e.getDate()-e.getDay()+(0===e.getDay()?-6:1),r=new Date(e.setDate(n)),o=new Date(e.setDate(r.getDate()+6));this.selectedDate=this.timeFilter.date=[r,o]}else{var c;switch(this.timeFilter.duration){case"day":c=e;break;case"month":e=new Date(e.getFullYear(),e.getMonth()-1,1),c=new Date(e.getFullYear(),e.getMonth()+1,0);break;case"year":e=new Date(e.getFullYear(),1,1),c=new Date(e.getFullYear(),12,0)}this.selectedDate=e,this.timeFilter.date=[e,c],console.log(e)}},setDate:function(t){var e,n=this.timeFilter.date[0];switch(this.timeFilter.duration){case"day":e=n.setDate(n.getDate()+t);break;case"week":e=n.setDate(n.getDate()+7*t);break;case"month":e=n.setMonth(n.getMonth()+t);break;case"year":e=n.setFullYear(n.getFullYear()+t)}e=new Date(e),this.selectDate(e)},toggleCalendar:function(t){this.$refs.calendar.toggle(t)},showLabelInfo:function(t){this.groupInfo=t.dataset.labelData}}},A=(n(531),Object(y.a)(U,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("card",{attrs:{icon:{color:"blue",name:"chart-line"},title:"Data from local device(s)"}},[n("div",{staticClass:"space-x-4",attrs:{slot:"center"},slot:"center"},[n("button",{staticClass:"font-bold",on:{click:function(e){return t.setDate(-1)}}},[n("i",{staticClass:"la la-lg la-angle-left"})]),t._v(" "),n("button",{staticClass:"font-bold cursor-pointer",on:{click:t.toggleCalendar}},[t._v(t._s(t.formattedDate)+" "),n("i",{staticClass:"la la-angle-down"})]),t._v(" "),n("button",{staticClass:"font-bold",on:{click:function(e){return t.setDate(1)}}},[n("i",{staticClass:"la la-lg la-angle-right"})]),t._v(" "),n(f.a,{ref:"calendar"},[n(l.a,{attrs:{inline:!0,value:t.selectedDate,view:t.options.calendarView[t.timeFilter.duration],selectionMode:"week"===t.timeFilter.duration?"range":"single"},on:{input:function(e){return t.selectDate(e)}}})],1)],1),t._v(" "),n("div",{attrs:{slot:"end"},slot:"end"},[n(o.a,{attrs:{options:t.options.duration,optionLabel:"name",optionValue:"key"},model:{value:t.timeFilter.duration,callback:function(e){t.$set(t.timeFilter,"duration",e)},expression:"timeFilter.duration"}})],1),t._v(" "),n("div",{staticClass:"grid grid-cols-10"},[n("div",{staticClass:"relative col-span-8"},[t.graphData?n("chart",{attrs:{type:"line",data:t.graphData,options:t.basicOptions,plugins:t.chartPlugins},on:{select:t.showLabelInfo}}):t._e(),t._v(" "),t.loading?n("div",{staticClass:"loading-container"}):t._e()],1),t._v(" "),n("div",{staticClass:"col-span-2"},[n("div",{ref:"legend",staticClass:"h-full overflow-auto",staticStyle:{width:"180px"}})])]),t._v(" "),t.showModal?n("modal",{attrs:{"button-position":"top",title:"dst"===t.filter.group_by?"Destination":"Device"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},["device"===t.groupInfo.group_type?n("device-info",{attrs:{device:t.groupInfo}}):t._e(),t._v(" "),"company"===t.groupInfo.group_type?n("company-detail",{attrs:{company:t.groupInfo}}):"server_group"===t.groupInfo.group_type?n("server-group-detail",{attrs:{"server-group":t.groupInfo}}):t._e()],1):t._e()],1)}),[],!1,null,"718da78e",null));e.a=A.exports},522:function(t,e,n){"use strict";var r={name:"Card",props:{title:String,icon:Object}},o=n(15),component=Object(o.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bg-white shadow sm:rounded-md"},[n("div",{staticClass:"bg-white p-4 border-gray-200 items-center flex justify-between"},[n("div",{staticClass:"flex items-center"},[t._t("title",(function(){return[t.icon?n("i",{staticClass:"la la-2x",class:["la-"+t.icon.name,"text-"+(t.icon.color?t.icon.color:"blue")+"-400"]}):t._e(),t._v(" "),n("h3",{staticClass:"text-lg leading-6 font-medium text-gray-900 ml-2"},[t._v(t._s(t.title))])]}))],2),t._v(" "),n("div",[t._t("center")],2),t._v(" "),n("div",[t._t("end")],2)]),t._v(" "),t._t("default")],2)}),[],!1,null,null,null);e.a=component.exports},529:function(t,e,n){"use strict";n(518)},530:function(t,e,n){var r=n(21)((function(i){return i[1]}));r.push([t.i,".p-chart{position:relative}",""]),r.locals={},t.exports=r},531:function(t,e,n){"use strict";n(519)},532:function(t,e,n){var r=n(21)((function(i){return i[1]}));r.push([t.i,".new-device-list[data-v-718da78e]{max-height:400px}.loading-container[data-v-718da78e]{position:absolute;inset:0 0 0 0;background:hsla(0,0%,100%,.7)}",""]),r.locals={},t.exports=r}}]);